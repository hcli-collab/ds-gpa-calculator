<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DS-GPA 計算器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
        }

        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            background-color: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .radio-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .radio-option {
            flex: 1;
            min-width: 140px;
        }

        .radio-option input[type="radio"] {
            display: none;
        }

        .radio-option label {
            display: block;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            font-weight: 500;
        }

        .radio-option input[type="radio"]:checked + label {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .radio-option label:hover {
            border-color: #667eea;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            transition: border-color 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 20px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .result-box {
            display: none;
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 10px;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-box h3 {
            font-size: 22px;
            margin-bottom: 15px;
        }

        .result-box p {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .result-box .score {
            font-size: 32px;
            font-weight: bold;
            margin: 15px 0;
        }

        .note {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 5px;
            font-size: 14px;
            color: #856404;
        }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }

        .tab {
            padding: 10px 15px;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            flex: 1;
            min-width: 130px;
            text-align: center;
            line-height: 1.4;
        }

        .tab:hover {
            background: #e8e8e8;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .reset-btn {
            width: 100%;
            padding: 12px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 15px;
        }

        .reset-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        /* 綜合評估樣式 */
        .comprehensive-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .assessment-results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .assessment-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
        }

        .assessment-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .assessment-card h4 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 16px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .assessment-card .score-display {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }

        .assessment-card .survival-display {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 14px;
        }

        .assessment-card .survival-display strong {
            display: block;
            margin-bottom: 5px;
            color: #333;
        }

        .assessment-card .missing-data {
            color: #dc3545;
            font-style: italic;
            font-size: 13px;
            margin-top: 10px;
            padding: 8px;
            background: #ffe5e5;
            border-radius: 5px;
        }

        .assessment-card .data-complete {
            color: #28a745;
            font-weight: 500;
            font-size: 13px;
            margin-top: 10px;
            padding: 8px;
            background: #e8f5e9;
            border-radius: 5px;
        }

        .input-group-inline {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }

        .input-group-inline label {
            min-width: 150px;
            font-weight: 500;
        }

        .input-group-inline input,
        .input-group-inline select {
            flex: 1;
        }

        #comprehensive-results {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>DS-GPA 計算器</h1>
            <p>Diagnosis-Specific Graded Prognostic Assessment</p>
        </div>

        <div class="content">
            <!-- 標籤頁導航 -->
            <div class="tabs">
                <div class="tab active" onclick="switchTab('comprehensive')">
                    綜合評估<br><span style="font-size: 13px; opacity: 0.9;">Comprehensive</span>
                </div>
                <div class="tab" onclick="switchTab('lung_adeno')">
                    肺腺癌<br><span style="font-size: 13px; opacity: 0.9;">Lung Adeno</span>
                </div>
                <div class="tab" onclick="switchTab('lung_non_adeno')">
                    肺非腺癌<br><span style="font-size: 13px; opacity: 0.9;">Lung Non-Adeno</span>
                </div>
                <div class="tab" onclick="switchTab('sclc')">
                    小細胞肺癌<br><span style="font-size: 13px; opacity: 0.9;">SCLC</span>
                </div>
                <div class="tab" onclick="switchTab('melanoma')">
                    黑色素瘤<br><span style="font-size: 13px; opacity: 0.9;">Melanoma</span>
                </div>
                <div class="tab" onclick="switchTab('breast')">
                    乳癌<br><span style="font-size: 13px; opacity: 0.9;">Breast Cancer</span>
                </div>
                <div class="tab" onclick="switchTab('renal')">
                    腎細胞癌<br><span style="font-size: 13px; opacity: 0.9;">Renal Cell Ca</span>
                </div>
                <div class="tab" onclick="switchTab('gi')">
                    消化道癌症<br><span style="font-size: 13px; opacity: 0.9;">GI Cancers</span>
                </div>
            </div>

            <!-- 綜合評估 -->
            <div id="comprehensive" class="tab-content active">
                <h3 style="color: #667eea; margin-bottom: 20px;">綜合評估 - 輸入病人資料</h3>
                <form id="comprehensive-form" onsubmit="calculateComprehensive(event)">
                    <div class="comprehensive-form">
                        <!-- 基本資料 -->
                        <div class="form-group">
                            <label>KPS 評分 (0-100)</label>
                            <input type="number" id="comp_kps" class="input-field" min="0" max="100" required>
                        </div>

                        <div class="form-group">
                            <label>年齡</label>
                            <input type="number" id="comp_age" class="input-field" min="0" max="120" required>
                        </div>

                        <div class="form-group">
                            <label>腦轉移數量</label>
                            <input type="number" id="comp_num_bm" class="input-field" min="0" required>
                        </div>

                        <div class="form-group">
                            <label>腦外轉移</label>
                            <select id="comp_ecm" class="input-field" required>
                                <option value="">-- 請選擇 --</option>
                                <option value="absent">無 (Absent)</option>
                                <option value="present">有 (Present)</option>
                            </select>
                        </div>

                        <!-- 肺癌相關 -->
                        <div class="form-group">
                            <label>EGFR/ALK 狀態</label>
                            <select id="comp_gene" class="input-field">
                                <option value="">-- 未檢測 --</option>
                                <option value="positive">Either Positive</option>
                                <option value="negative">Both Neg/Unknown</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>PD-L1 Expression</label>
                            <select id="comp_pdl1" class="input-field">
                                <option value="">-- 未檢測 --</option>
                                <option value="positive">≥1%</option>
                                <option value="negative">Neg/Unknown</option>
                            </select>
                        </div>

                        <!-- 黑色素瘤相關 -->
                        <div class="form-group">
                            <label>Serum LDH</label>
                            <input type="number" id="comp_ldh" class="input-field" placeholder="未檢測">
                        </div>

                        <div class="form-group">
                            <label>Prior ICI</label>
                            <select id="comp_ici" class="input-field">
                                <option value="">-- 未知 --</option>
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>

                        <!-- 乳癌相關 -->
                        <div class="form-group">
                            <label>腫瘤亞型 (乳癌)</label>
                            <select id="comp_subtype" class="input-field">
                                <option value="">-- 未知 --</option>
                                <option value="her2">HER2+/Luminal B</option>
                                <option value="luminal">Luminal A</option>
                                <option value="basal">Basal</option>
                            </select>
                        </div>

                        <!-- 腎細胞癌相關 -->
                        <div class="form-group">
                            <label>Serum Hemoglobin (g/dL)</label>
                            <input type="number" id="comp_hgb" class="input-field" step="0.1" placeholder="未檢測">
                        </div>
                    </div>

                    <button type="submit" class="btn">計算所有癌症 GPA 分數</button>
                    <button type="button" class="reset-btn" onclick="resetComprehensive()">重設</button>
                </form>

                <div id="comprehensive-results"></div>
            </div>

            <!-- 肺腺癌 -->
            <div id="lung_adeno" class="tab-content">
                <form onsubmit="calculateScore(event, 'lung_adeno')">
                    <div id="fields_lung_adeno"></div>
                    <button type="submit" class="btn">計算 DS-GPA 分數</button>
                    <button type="button" class="reset-btn" onclick="resetForm('lung_adeno')">重設</button>
                </form>
                <div id="result_lung_adeno" class="result-box"></div>
            </div>

            <!-- 肺非腺癌 -->
            <div id="lung_non_adeno" class="tab-content">
                <form onsubmit="calculateScore(event, 'lung_non_adeno')">
                    <div id="fields_lung_non_adeno"></div>
                    <button type="submit" class="btn">計算 DS-GPA 分數</button>
                    <button type="button" class="reset-btn" onclick="resetForm('lung_non_adeno')">重設</button>
                </form>
                <div id="result_lung_non_adeno" class="result-box"></div>
            </div>

            <!-- 小細胞肺癌 -->
            <div id="sclc" class="tab-content">
                <form onsubmit="calculateScore(event, 'sclc')">
                    <div id="fields_sclc"></div>
                    <button type="submit" class="btn">計算 DS-GPA 分數</button>
                    <button type="button" class="reset-btn" onclick="resetForm('sclc')">重設</button>
                </form>
                <div id="result_sclc" class="result-box"></div>
            </div>

            <!-- 黑色素瘤 -->
            <div id="melanoma" class="tab-content">
                <form onsubmit="calculateScore(event, 'melanoma')">
                    <div id="fields_melanoma"></div>
                    <button type="submit" class="btn">計算 DS-GPA 分數</button>
                    <button type="button" class="reset-btn" onclick="resetForm('melanoma')">重設</button>
                </form>
                <div id="result_melanoma" class="result-box"></div>
            </div>

            <!-- 乳癌 -->
            <div id="breast" class="tab-content">
                <form onsubmit="calculateScore(event, 'breast')">
                    <div id="fields_breast"></div>
                    <button type="submit" class="btn">計算 DS-GPA 分數</button>
                    <button type="button" class="reset-btn" onclick="resetForm('breast')">重設</button>
                </form>
                <div id="result_breast" class="result-box"></div>
            </div>

            <!-- 腎細胞癌 -->
            <div id="renal" class="tab-content">
                <form onsubmit="calculateScore(event, 'renal')">
                    <div id="fields_renal"></div>
                    <button type="submit" class="btn">計算 DS-GPA 分數</button>
                    <button type="button" class="reset-btn" onclick="resetForm('renal')">重設</button>
                </form>
                <div id="result_renal" class="result-box"></div>
            </div>

            <!-- 消化道癌症 -->
            <div id="gi" class="tab-content">
                <form onsubmit="calculateScore(event, 'gi')">
                    <div id="fields_gi"></div>
                    <button type="submit" class="btn">計算 DS-GPA 分數</button>
                    <button type="button" class="reset-btn" onclick="resetForm('gi')">重設</button>
                </form>
                <div id="result_gi" class="result-box"></div>
            </div>

            <div class="note">
                <strong>注意：</strong>此工具僅供參考。治療決策應由多學科團隊共同制定。
            </div>
        </div>
    </div>

    <script>
        const formFields = {
            lung_adeno: [
                { id: 'kps', label: 'KPS 評分', type: 'radio', options: [
                    { value: '1.0', label: '90-100' },
                    { value: '0.5', label: '80' },
                    { value: '0.0', label: '≤70' }
                ]},
                { id: 'age', label: '年齡', type: 'radio', options: [
                    { value: '0.5', label: '<70' },
                    { value: '0.0', label: '≥70' }
                ]},
                { id: 'num_bm', label: '腦轉移數量', type: 'radio', options: [
                    { value: '0.5', label: '1-4' },
                    { value: '0.0', label: '≥5' }
                ]},
                { id: 'ecm', label: '腦外轉移', type: 'radio', options: [
                    { value: '1.0', label: '無 (Absent)' },
                    { value: '0.0', label: '有 (Present)' }
                ]},
                { id: 'gene', label: 'EGFR/ALK 狀態', type: 'radio', options: [
                    { value: '0.5', label: 'Either Positive' },
                    { value: '0.0', label: 'Both Neg/Unknown' }
                ]},
                { id: 'pdl1', label: 'PD-L1 Expression', type: 'radio', options: [
                    { value: '0.5', label: '≥1%' },
                    { value: '0.0', label: 'Neg/Unknown' }
                ]}
            ],
            lung_non_adeno: [
                { id: 'kps', label: 'KPS 評分', type: 'radio', options: [
                    { value: '2.0', label: '90-100' },
                    { value: '1.5', label: '80' },
                    { value: '1.0', label: '70' },
                    { value: '0.0', label: '≤60' }
                ]},
                { id: 'age', label: '年齡', type: 'radio', options: [
                    { value: '0.5', label: '<70' },
                    { value: '0.0', label: '≥70' }
                ]},
                { id: 'num_bm', label: '腦轉移數量', type: 'radio', options: [
                    { value: '0.5', label: '1-4' },
                    { value: '0.0', label: '≥5' }
                ]},
                { id: 'ecm', label: '腦外轉移', type: 'radio', options: [
                    { value: '1.0', label: '無 (Absent)' },
                    { value: '0.0', label: '有 (Present)' }
                ]}
            ],
            sclc: [
                { id: 'kps', label: 'KPS 評分', type: 'radio', options: [
                    { value: '2.0', label: '100' },
                    { value: '1.5', label: '90' },
                    { value: '1.0', label: '80' },
                    { value: '0.5', label: '70' },
                    { value: '0.0', label: '≤60' }
                ]},
                { id: 'age', label: '年齡', type: 'radio', options: [
                    { value: '0.5', label: '<75' },
                    { value: '0.0', label: '≥75' }
                ]},
                { id: 'num_bm', label: '腦轉移數量', type: 'radio', options: [
                    { value: '1.0', label: '1-3' },
                    { value: '0.5', label: '4-7' },
                    { value: '0.0', label: '≥8' }
                ]},
                { id: 'ecm', label: '腦外轉移', type: 'radio', options: [
                    { value: '0.5', label: '無 (Absent)' },
                    { value: '0.0', label: '有 (Present)' }
                ]}
            ],
            melanoma: [
                { id: 'kps', label: 'KPS 評分', type: 'radio', options: [
                    { value: '1.0', label: '90-100' },
                    { value: '0.5', label: '70-80' },
                    { value: '0.0', label: '60' }
                ]},
                { id: 'num_bm', label: '腦轉移數量', type: 'radio', options: [
                    { value: '1.0', label: '1-4' },
                    { value: '0.0', label: '>4' }
                ]},
                { id: 'ecm', label: '腦外轉移', type: 'radio', options: [
                    { value: '1.0', label: '無 (Absent)' },
                    { value: '0.0', label: '有 (Present)' }
                ]},
                { id: 'ldh', label: 'Serum LDH', type: 'radio', options: [
                    { value: '0.5', label: '<250' },
                    { value: '0.0', label: '≥250' }
                ]},
                { id: 'ici', label: 'Prior ICI', type: 'radio', options: [
                    { value: '0.5', label: 'No' },
                    { value: '0.0', label: 'Yes' }
                ]}
            ],
            breast: [
                { id: 'subtype', label: '腫瘤亞型 (Tumor Subtype)', type: 'radio', options: [
                    { value: '1.5', label: 'HER2+/Luminal B' },
                    { value: '0.5', label: 'Luminal A' },
                    { value: '0.0', label: 'Basal' }
                ]},
                { id: 'kps', label: 'KPS 評分', type: 'radio', options: [
                    { value: '1.0', label: '90-100' },
                    { value: '0.5', label: '70-80' },
                    { value: '0.0', label: '≤60' }
                ]},
                { id: 'age', label: '年齡', type: 'radio', options: [
                    { value: '0.5', label: '<60' },
                    { value: '0.0', label: '≥60' }
                ]},
                { id: 'num_bm', label: '腦轉移數量', type: 'radio', options: [
                    { value: '0.5', label: '1' },
                    { value: '0.0', label: '≥2' }
                ]},
                { id: 'ecm', label: '腦外轉移', type: 'radio', options: [
                    { value: '0.5', label: '無 (Absent)' },
                    { value: '0.0', label: '有 (Present)' }
                ]}
            ],
            renal: [
                { id: 'kps', label: 'KPS 評分', type: 'radio', options: [
                    { value: '2.0', label: '90-100' },
                    { value: '1.0', label: '80' },
                    { value: '0.0', label: '<70' }
                ]},
                { id: 'num_bm', label: '腦轉移數量', type: 'radio', options: [
                    { value: '0.5', label: '1-4' },
                    { value: '0.0', label: '≥5' }
                ]},
                { id: 'ecm', label: '腦外轉移', type: 'radio', options: [
                    { value: '0.5', label: '無 (Absent)' },
                    { value: '0.0', label: '有 (Present)' }
                ]},
                { id: 'hgb', label: 'Serum Hemoglobin (g/dL)', type: 'radio', options: [
                    { value: '1.0', label: '>12.5' },
                    { value: '0.5', label: '11.1-12.5' },
                    { value: '0.0', label: '<11.0' }
                ]}
            ],
            gi: [
                { id: 'kps', label: 'KPS 評分', type: 'radio', options: [
                    { value: '2.0', label: '90-100' },
                    { value: '1.0', label: '80' },
                    { value: '0.0', label: '≤70' }
                ]},
                { id: 'age', label: '年齡', type: 'radio', options: [
                    { value: '0.5', label: '<60' },
                    { value: '0.0', label: '≥60' }
                ]},
                { id: 'num_bm', label: '腦轉移數量', type: 'radio', options: [
                    { value: '0.5', label: '2-3' },
                    { value: '0.0', label: '≥4' }
                ]},
                { id: 'ecm', label: '腦外轉移', type: 'radio', options: [
                    { value: '0.5', label: '無 (Absent)' },
                    { value: '0.0', label: '有 (Present)' }
                ]}
            ]
        };

        const survivalData = {
            lung_adeno: {
                cohort: '17 個月 (6-46)',
                ranges: {
                    3.5: '52 個月 (25-69)',
                    2.5: '30 個月 (12-NR)',
                    1.5: '15 個月 (5-38)',
                    0: '6 個月 (2-13)'
                }
            },
            lung_non_adeno: {
                cohort: '8 個月 (3-19)',
                ranges: {
                    3.5: '19 個月 (8-33)',
                    2.5: '10 個月 (4-21)',
                    1.5: '5 個月 (3-12)',
                    0: '2 個月 (1-4)'
                }
            },
            sclc: {
                cohort: '10 個月 (5-20)',
                ranges: {
                    3.5: '23 個月 (11-NR)',
                    2.5: '13 個月 (7-23)',
                    1.5: '8 個月 (4-15)',
                    0: '4 個月 (2-8)'
                }
            },
            melanoma: {
                cohort: '10 個月 (4-26)',
                ranges: {
                    2.5: '43 個月 (35-51)',
                    1.5: '13 個月 (11-15)',
                    0: '5 個月 (4-6)'
                }
            },
            breast: {
                cohort: '16 個月 (7-34)',
                ranges: {
                    3.5: '36 個月 (18-78)',
                    2.5: '24 個月 (11-47)',
                    1.5: '13 個月 (6-27)',
                    0: '6 個月 (2-12)'
                }
            },
            renal: {
                cohort: '12 個月 (4-30)',
                ranges: {
                    3.5: '35 個月 (13-61)',
                    2.5: '17 個月 (8-36)',
                    1.5: '12 個月 (4-25)',
                    0: '4 個月 (2-8)'
                }
            },
            gi: {
                cohort: '8 個月 (3-18)',
                ranges: {
                    3.5: '17 個月 (9-30)',
                    2.5: '11 個月 (4-21)',
                    1.5: '7 個月 (3-17)',
                    0: '3 個月 (2-8)'
                }
            }
        };

        // 初始化所有表單
        window.onload = function() {
            Object.keys(formFields).forEach(cancerType => {
                renderFormFields(cancerType);
            });
        };

        function switchTab(cancerType) {
            // 隱藏所有標籤內容
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 移除所有標籤的 active 類
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // 顯示選中的標籤內容
            document.getElementById(cancerType).classList.add('active');
            
            // 添加 active 類到選中的標籤
            event.target.classList.add('active');
        }

        function renderFormFields(cancerType) {
            const container = document.getElementById(`fields_${cancerType}`);
            container.innerHTML = '';

            const fields = formFields[cancerType];
            fields.forEach(field => {
                const fieldDiv = document.createElement('div');
                fieldDiv.className = 'form-group';

                const label = document.createElement('label');
                label.textContent = field.label;
                fieldDiv.appendChild(label);

                if (field.type === 'radio') {
                    const radioGroup = document.createElement('div');
                    radioGroup.className = 'radio-group';

                    field.options.forEach((option, index) => {
                        const radioDiv = document.createElement('div');
                        radioDiv.className = 'radio-option';

                        const input = document.createElement('input');
                        input.type = 'radio';
                        input.id = `${cancerType}_${field.id}_${index}`;
                        input.name = `${cancerType}_${field.id}`;
                        input.value = option.value;
                        input.required = true;

                        const optionLabel = document.createElement('label');
                        optionLabel.htmlFor = `${cancerType}_${field.id}_${index}`;
                        optionLabel.textContent = option.label;

                        radioDiv.appendChild(input);
                        radioDiv.appendChild(optionLabel);
                        radioGroup.appendChild(radioDiv);
                    });

                    fieldDiv.appendChild(radioGroup);
                }

                container.appendChild(fieldDiv);
            });
        }

        function calculateScore(event, cancerType) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);
            let totalScore = 0;

            for (let [key, value] of formData.entries()) {
                totalScore += parseFloat(value);
            }

            displayResult(totalScore, cancerType);
        }

        function displayResult(score, cancerType) {
            const resultDiv = document.getElementById(`result_${cancerType}`);
            let survival = '';

            const data = survivalData[cancerType];
            
            // 黑色素瘤的分數範圍不同 (最高到 3.0)
            if (cancerType === 'melanoma') {
                if (score >= 2.5) survival = data.ranges[2.5];
                else if (score >= 1.5) survival = data.ranges[1.5];
                else survival = data.ranges[0];
            } else {
                if (score >= 3.5) survival = data.ranges[3.5];
                else if (score >= 2.5) survival = data.ranges[2.5];
                else if (score >= 1.5) survival = data.ranges[1.5];
                else survival = data.ranges[0];
            }

            resultDiv.innerHTML = `
                <h3>計算結果</h3>
                <div class="score">DS-GPA 分數：${score.toFixed(1)}/4.0</div>
                <p><strong>預估中位存活期：</strong>${survival}</p>
                <p style="font-size: 14px; opacity: 0.9;"><strong>Overall Cohort：</strong>${data.cohort}</p>
            `;

            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function resetForm(cancerType) {
            // 重設表單
            const form = document.querySelector(`#${cancerType} form`);
            form.reset();
            
            // 隱藏結果
            const resultDiv = document.getElementById(`result_${cancerType}`);
            resultDiv.style.display = 'none';
        }

        // 綜合評估功能
        function calculateComprehensive(event) {
            event.preventDefault();

            // 獲取輸入數據
            const kps = parseInt(document.getElementById('comp_kps').value);
            const age = parseInt(document.getElementById('comp_age').value);
            const numBm = parseInt(document.getElementById('comp_num_bm').value);
            const ecm = document.getElementById('comp_ecm').value;
            const gene = document.getElementById('comp_gene').value;
            const pdl1 = document.getElementById('comp_pdl1').value;
            const ldh = document.getElementById('comp_ldh').value;
            const ici = document.getElementById('comp_ici').value;
            const subtype = document.getElementById('comp_subtype').value;
            const hgb = document.getElementById('comp_hgb').value;

            const results = [];

            // 1. 肺腺癌
            results.push(assessLungAdeno(kps, age, numBm, ecm, gene, pdl1));

            // 2. 肺非腺癌
            results.push(assessLungNonAdeno(kps, age, numBm, ecm));

            // 3. 小細胞肺癌
            results.push(assessSCLC(kps, age, numBm, ecm));

            // 4. 黑色素瘤
            results.push(assessMelanoma(kps, numBm, ecm, ldh, ici));

            // 5. 乳癌
            results.push(assessBreast(kps, age, numBm, ecm, subtype));

            // 6. 腎細胞癌
            results.push(assessRenal(kps, numBm, ecm, hgb));

            // 7. 消化道癌症
            results.push(assessGI(kps, age, numBm, ecm));

            displayComprehensiveResults(results);
        }

        function assessLungAdeno(kps, age, numBm, ecm, gene, pdl1) {
            let score = 0;
            let missing = [];

            // KPS
            if (kps >= 90) score += 1.0;
            else if (kps === 80) score += 0.5;

            // 年齡
            if (age < 70) score += 0.5;

            // 腦轉移
            if (numBm >= 1 && numBm <= 4) score += 0.5;

            // 腦外轉移
            if (ecm === 'absent') score += 1.0;

            // EGFR/ALK
            if (gene === 'positive') score += 0.5;
            else if (gene === '') missing.push('EGFR/ALK 狀態');

            // PD-L1
            if (pdl1 === 'positive') score += 0.5;
            else if (pdl1 === '') missing.push('PD-L1 Expression');

            return {
                name: '肺腺癌 (Lung Adenocarcinoma)',
                score: score,
                maxScore: 4.0,
                missing: missing,
                survival: getSurvival('lung_adeno', score)
            };
        }

        function assessLungNonAdeno(kps, age, numBm, ecm) {
            let score = 0;

            // KPS
            if (kps >= 90) score += 2.0;
            else if (kps === 80) score += 1.5;
            else if (kps === 70) score += 1.0;

            // 年齡
            if (age < 70) score += 0.5;

            // 腦轉移
            if (numBm >= 1 && numBm <= 4) score += 0.5;

            // 腦外轉移
            if (ecm === 'absent') score += 1.0;

            return {
                name: '肺非腺癌 (Lung Non-Adenocarcinoma)',
                score: score,
                maxScore: 4.0,
                missing: [],
                survival: getSurvival('lung_non_adeno', score)
            };
        }

        function assessSCLC(kps, age, numBm, ecm) {
            let score = 0;

            // KPS
            if (kps === 100) score += 2.0;
            else if (kps === 90) score += 1.5;
            else if (kps === 80) score += 1.0;
            else if (kps === 70) score += 0.5;

            // 年齡
            if (age < 75) score += 0.5;

            // 腦轉移
            if (numBm >= 1 && numBm <= 3) score += 1.0;
            else if (numBm >= 4 && numBm <= 7) score += 0.5;

            // 腦外轉移
            if (ecm === 'absent') score += 0.5;

            return {
                name: '小細胞肺癌 (SCLC)',
                score: score,
                maxScore: 4.0,
                missing: [],
                survival: getSurvival('sclc', score)
            };
        }

        function assessMelanoma(kps, numBm, ecm, ldh, ici) {
            let score = 0;
            let missing = [];

            // KPS
            if (kps >= 90) score += 1.0;
            else if (kps >= 70) score += 0.5;

            // 腦轉移
            if (numBm >= 1 && numBm <= 4) score += 1.0;

            // 腦外轉移
            if (ecm === 'absent') score += 1.0;

            // LDH
            if (ldh !== '' && parseFloat(ldh) < 250) score += 0.5;
            else if (ldh === '') missing.push('Serum LDH');

            // ICI
            if (ici === 'no') score += 0.5;
            else if (ici === '') missing.push('Prior ICI');

            return {
                name: '黑色素瘤 (Melanoma)',
                score: score,
                maxScore: 3.0,
                missing: missing,
                survival: getSurvival('melanoma', score)
            };
        }

        function assessBreast(kps, age, numBm, ecm, subtype) {
            let score = 0;
            let missing = [];

            // 亞型
            if (subtype === 'her2') score += 1.5;
            else if (subtype === 'luminal') score += 0.5;
            else if (subtype === '') missing.push('腫瘤亞型');

            // KPS
            if (kps >= 90) score += 1.0;
            else if (kps >= 70) score += 0.5;

            // 年齡
            if (age < 60) score += 0.5;

            // 腦轉移
            if (numBm === 1) score += 0.5;

            // 腦外轉移
            if (ecm === 'absent') score += 0.5;

            return {
                name: '乳癌 (Breast Cancer)',
                score: score,
                maxScore: 4.0,
                missing: missing,
                survival: getSurvival('breast', score)
            };
        }

        function assessRenal(kps, numBm, ecm, hgb) {
            let score = 0;
            let missing = [];

            // KPS
            if (kps >= 90) score += 2.0;
            else if (kps === 80) score += 1.0;

            // 腦轉移
            if (numBm >= 1 && numBm <= 4) score += 0.5;

            // 腦外轉移
            if (ecm === 'absent') score += 0.5;

            // 血紅素
            if (hgb !== '') {
                const hgbVal = parseFloat(hgb);
                if (hgbVal > 12.5) score += 1.0;
                else if (hgbVal >= 11.1) score += 0.5;
            } else {
                missing.push('Serum Hemoglobin');
            }

            return {
                name: '腎細胞癌 (Renal Cell Carcinoma)',
                score: score,
                maxScore: 4.0,
                missing: missing,
                survival: getSurvival('renal', score)
            };
        }

        function assessGI(kps, age, numBm, ecm) {
            let score = 0;

            // KPS
            if (kps >= 90) score += 2.0;
            else if (kps === 80) score += 1.0;

            // 年齡
            if (age < 60) score += 0.5;

            // 腦轉移
            if (numBm >= 2 && numBm <= 3) score += 0.5;

            // 腦外轉移
            if (ecm === 'absent') score += 0.5;

            return {
                name: '消化道癌症 (GI Cancers)',
                score: score,
                maxScore: 4.0,
                missing: [],
                survival: getSurvival('gi', score)
            };
        }

        function getSurvival(cancerType, score) {
            const data = survivalData[cancerType];
            
            if (cancerType === 'melanoma') {
                if (score >= 2.5) return data.ranges[2.5];
                else if (score >= 1.5) return data.ranges[1.5];
                else return data.ranges[0];
            } else {
                if (score >= 3.5) return data.ranges[3.5];
                else if (score >= 2.5) return data.ranges[2.5];
                else if (score >= 1.5) return data.ranges[1.5];
                else return data.ranges[0];
            }
        }

        function displayComprehensiveResults(results) {
            const resultsDiv = document.getElementById('comprehensive-results');
            
            let html = '<h3 style="color: #667eea; margin: 30px 0 20px 0;">評估結果</h3>';
            html += '<div class="assessment-results-grid">';
            
            results.forEach(result => {
                const missingText = result.missing.length > 0 
                    ? `<div class="missing-data">⚠️ 缺少：${result.missing.join(', ')}</div>`
                    : '<div class="data-complete">✓ 資料完整</div>';

                html += `
                    <div class="assessment-card">
                        <h4>${result.name}</h4>
                        <div class="score-display">${result.score.toFixed(1)} / ${result.maxScore.toFixed(1)}</div>
                        <div class="survival-display">
                            <strong>預估中位存活期</strong>
                            ${result.survival}
                        </div>
                        ${missingText}
                    </div>
                `;
            });

            html += '</div>';
            resultsDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function resetComprehensive() {
            document.getElementById('comprehensive-form').reset();
            document.getElementById('comprehensive-results').style.display = 'none';
        }
    </script>
</body>
</html>